<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>智慧园区后台 | kilito</title><meta name="keywords" content="智慧园区"><meta name="author" content="kilito"><meta name="copyright" content="kilito"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="智慧园区后台"><meta name="application-name" content="智慧园区后台"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="智慧园区后台"><meta property="og:url" content="https://ekilito.github.io/posts/883eae6.html"><meta property="og:site_name" content="kilito"><meta property="og:description" content="总结vue-admin场景： 二次迭代  vue-admin-template  下载项目 找到核心内容 （自己分到的业务模块） 项目目录固定的抽象模式  语义化  + 增加可维护性  src - 业务代码 最终浏览器中运行 （目录划分相似 语义化 模块化 - 维护方便） src之外 - 开发阶段配"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2023/09/04/64f5e41cda997.png"><meta property="article:author" content="kilito"><meta property="article:tag" content="个人博客,kilito,小清"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/09/04/64f5e41cda997.png"><meta name="description" content="总结vue-admin场景： 二次迭代  vue-admin-template  下载项目 找到核心内容 （自己分到的业务模块） 项目目录固定的抽象模式  语义化  + 增加可维护性  src - 业务代码 最终浏览器中运行 （目录划分相似 语义化 模块化 - 维护方便） src之外 - 开发阶段配"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://ekilito.github.io/posts/883eae6"><link rel="preconnect" href="//npm.elemecdn.com"/><link rel="preconnect" href="//npm.onmicrosoft.cn"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="manifest" href="/manifest.json"/><meta name="msapplication-TileColor" content="var(--anzhiyu-main)"/><link rel="mask-icon" href="/img/siteicon/apple-icon-180.png" color="#5bbad5"/><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/apple-icon-180.png"/><link rel="apple-touch-icon-precomposed" sizes="180x180" href="/img/siteicon/apple-icon-180.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"/><link rel="bookmark" href="/img/siteicon/apple-icon-180.png"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2732-2048.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2388.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2388-1668.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1536-2048.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-1536.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2224.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2224-1668.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1620-2160.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2160-1620.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1290-2796.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2796-1290.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1179-2556.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2556-1179.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1284-2778.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2778-1284.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1170-2532.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2532-1170.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1125-2436.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2436-1125.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2688.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2688-1242.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-828-1792.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1792-828.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2208.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2208-1242.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-750-1334.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1334-750.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-640-1136.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1136-640.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"与数百名博主无限进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走嘛！","backTitle":"♪(^∇^*)欢迎回来！"},
  LA51: {"enable":true,"ck":"3FXVpXQlU2qrgdld","LingQueMonitorID":"3FXVpXQlU2qrgdld"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://twikoo.wudl.cn/',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":4000,"accessToken":"30796eace3084cff910c7e43aa524164","mailMd5":""},
  root: '/',
  preloader: {"source":3},
  friends_vue_info: {"apiurl":"https://puquan.wudl.cn/"},
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: kilito","link":"链接: ","source":"来源: kilito","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'kilito',
  title: '智慧园区后台',
  postAI: '',
  pageFillDescription: '总结, vue-admin, 项目目录, 关键文件, request.js + apis, 登录, 为什么要使用Vuex+Cookies, cookie  vs  ls, token持久化, 请求头添加token（请求拦截器）, 记住我优化, 接口错误统一处理, token是否存在控制路由权限跳转, 数据基础渲染, 列表基础渲染, 搜索功能, 状态适配, 新增功能, 表单校验, 梳理新增和编辑, 上传图片, 表单校验, vue2的响应式缺点, 下拉列表的数据, 表单的清空, 网络请求的优化, 带有模板的状态格式化, 对象动态添加响应式属性, 后端返回的数据字段不够 需要前端自定义字段, word 文档的预览, 业务数据状态变化, excel导出, 账单支付金额的接口计算, tab切换类交互, 树状组件, 前端同步异步的问题, RBAC指的是什么？, 前端菜单路由权限控制总结场景二次迭代下载项目找到核心内容自己分到的业务模块项目目录固定的抽象模式语义化增加可维护性业务代码最终浏览器中运行目录划分相似语义化模块化维护方便之外开发阶段配置文件关键文件包管理文件可执行的命令可以自定义生产依赖这里面的包参与业务开发最终打包上线参与打包运行浏览器开发依赖开发阶段生效不参与打包不参与打包开发阶段生效团队开发模式下整个团队要保证每个人在本地依赖的包都是一样的不写业务代码全局初始化的事情初始化三方组件样式初始化全局注册挂载挂载渲染根组件组件化的开发模式组件树如果左侧菜单只有一项如何配置如果左侧菜单有嵌套如何配置解决的问题把应用中很多地方都会用到的状态统一管理模块化的开发模式定义模块把子模块在选项中注册好使用中的数据或者方法加上模块名模块化子模块和数据相关的所有操作都放到中维护组件只做一个事儿触发产生一个实例对象给每一个函数使用一对多的关系配置一次所有的函数都会跟着生效基础封装实例化请求拦截器拦截请求处理请求参数再交给后端中注入响应拦截器拦截返回数据做处理再交给客户端状态数据剥离拓展可以执行多次拦截器可以有多个串联参数的模式前一个拦截器处理完会把处理之后的数据下发给下一个拦截器继续处理拦截器函数中千万别弄丢通用配置定制化配置通用配置实例化基地址配置超时时间拓展方法可以调用多次每次执行都会生成一个独一无二的实例请求拦截器请求头中添加数据接口鉴权统一配置客户端发送请求请求拦截器针对请求参数做处理后端拓展可以添加多个请求拦截器客户端请求拦截器处理参数拦截器后端响应拦截器数据剥离错误处理前端自定义错误处理后端响应拦截器客户端成功回调失败回调不在这个之间如果后端不管接口成功还是失败统一返回请求拦截器响应拦截器一般项目中多数的接口使用的配置是相似的所以需要统一配置一次请求拦截器主要做的事情是在请求发送之前针对请求参数对象做一些事情比如添加鉴权响应拦截器主要做的事情是在响应数据返回到业务方之前针对响应对象做一些事情比如简化错误处理等登录业务模式表单基础校验表单统一校验按照业务要求编写校验规则对象组件绑定表单对象和规则对象组件通过属性指定要使用的校验规则基础校验表单对象规则对象属性指定一下要使用哪条规则双向绑定统一校验获取表单的实例对象调用方法后续的业务处理调用接口存入跳转首页提示用户表单校验先通过查看双向啊绑定是否成功对照接口文档查看接口参数是否一致拼写类型校验时机实时校验和统一校验都需要管理业务背景的有效期会持续一段时间在这段时间内没有必要重复请求但是本身是基于内存的管理方式刷新浏览器会丢失为了避免丢失需要配置持久化进行缓存基础思路存数据时一份存入一份存入中初始化时优先从本地取取不到再初始化为空串儿多模块共享维护管理方式为什么要使用俩种存储方式的优势都想要基于内存存取快但是刷新就丢失基于磁盘存取速度稍慢刷新不丢失持久化因为我们既可以享受速度优势封装优势同时保持持久化存数据的空间大小是否允许后端操作纯前端操作前端可操作后端也可操作占多数是否跟随接口发送持久化为什么要进行持久化基于的存储页面刷新丢失如何来做在获取到之后一式两份初始化的时候优先从本地取取不到才初始化为空基于内存快刷新就丢基于磁盘稍慢持久化请求头添加请求拦截器为什么要做接口鉴权怎么做请求拦截器中统一配置格式以后端要求的为主记住我优化基础实现逻辑如果当前用户选中了记住在登录时把用户的信息存入本地在组件初始化的时候去取数据回填如果当前没有选中在登录时把数据清空接口错误统一处理为什么统一处理很多个接口都需要做这个事儿而且报错的提示位置和字段和后端协商好的如何来做响应拦截器来做判断错误信息存在弹框提示是否存在控制路由权限跳转根据流程图分支语句权限相关的事儿都放到这里模块化的思想路由权限前置守卫引入立刻执行数据基础渲染基础实现逻辑准备静态模版解决初始报错在中把模版绑定的数据都声明一遍封装接口参数名称类型参数数量组件中封装一个独立的方法在方法中调用接口函数复用的好处调用之前做一些额外的参数处理选择一个合适生命周期钩子函数调用独立的方法都可以使用数据渲染模版数据驱动视图列表基础渲染实现步骤按照接口文档请求列表接口封装一下参数拼写类型准备响应式的数据以后端接口实际返回为主在封装一个方法参数的二次处理调用接口数据赋值生命周期钩子函数调用这个方法把响应式数据绑定组件身上文档组件要求通过什么属性绑定就通过生命属性分页功能分页的逻辑页数总条数单页的条数组件分好页传入总数单页条数默认页数分出来页数总条数每页条数点击每页的时候获取当前页的数据重新渲染到上点击分页交互的实现点击时拿到当前点击的页数父组件从子组件获取内部的数据子传父回调参数拿到的是当前页把点击的页数赋值给请求参数页数使用最新的请求参数获取列表数据使用当前的页数去后端要当前页的数据重新渲染到搜索功能思路分析把各种搜索条件当作请求参数发给后端后端会根据字段对数据库数据做过滤筛选拿到符合条件返回表单组件的双向绑定收集到当前的请求数据把收集到的表单参数发送接口给后端那符合条件的数据把拿到的数据关系显示在列表中下拉组件双向绑定收集当前选中的数据下拉框中的每一项中文显示选中之后赋值给的数据将来传给后端状态适配场景后端返回的数据无法直接显示到页面中男女转化的状态码数量只有两个解决方案三元表达式女男转化的状态码比较多解决方案映射的方案女男新增功能步骤点击跳转到新的路由页面在当前页面打开一个弹框准备表单项通常只要有表单就会有校验单独校验统一校验收集表单数据打开检测双向绑定是否提交接口字段不多不少字段名称完全对应类型完全匹配后续的逻辑处理提供用户重新拉取列表表单的重置路由的重置表单校验简单校验使用默认的配置项就可以完成指定要用哪条规则双向绑定自定义校验默认的配置声明式配置自定义校验逻辑命令式的校验写的式逻辑代码输入框的数据校验的那个数据校验放行函数不管在通过还是未通过都需要调用它对某些字段单独校验场景默认的表单校验管控不到出现在自定义组件中上传调用单独校验实例方法校验的字段表单功能的时候要提前做数据验证双向绑定是否生效生效之后再调用接口梳理新增和编辑新增点击新增按钮跳转到新增路由准备表单二次参数处理提交新增接口后续处理提示回跳编辑点击编辑按钮携带跳转到新增路由准备表单回填表单校验二次参数处理提交的更新接口提示回跳作用域插槽当前行的数据对象如果我们只是想使用插槽渲染模板如果我们除了想要使用插槽渲染模板而且还想要拿到它内部的数据类似于函数的形参组件内部会把当前行数数据对象当成一个实参传到的位置在内部传递实参的时候实参的格式当前行的对象数据因为本来传下来的就是一个对象所以通过解构赋值的方式去取参数编辑重点新增和编辑状态始终用的就是有代表当前是编辑状态没有代表就是新增状态有才获取详情接口有调用更新接口没有调用新增接口有显示编辑没有显示新增点击确定调用接口时区分状态之外还需区分参数如果是新增接口调用没有任何如果是更新接口调用请求参数中附加相关数据在数据回填的时候加进去通知后端要更新谁上传图片上传的流程点击上传按钮打开本地文件选择框上传前的文件校验接口要求传递一个类型的数据往的对象中字段使用完整的对象提交接口完成上传细节问题非常简单不需要做任何的自定义配置默认的配置项完成上传就行了需要自定义场景如果添加了上传前的校验流程先执行上传前的校验函数函数返回值为再执行上传函数函数参数上传前的函数对象做校验上传函数对象上传接口接口参数常规的接口上传接口前后端校验逻辑要保持一致文件大小小于文件类型前端要以这个为主因为接口不只是可以通过浏览器提交也可以通过其他方式提交基于界面操作类校验会失败自定义上传本来是一个用来配置默认上传的接口地址因为我们覆盖了所以用一个占个位置消除必填警告本身具备选择文件的能力覆盖原因默认的配置上传不够灵活仅支持一些简单的上传如果想要完全自定义上传在选择文件之后自动执行函数并且把一个对象传给我们对象中有一个属性就是我们要上传的对象上传前校验上传图片之前加一层校验目的为了限制用户上传的文件类型和大小如果我们添加了这个属性方法这个函数中必须的数据为才会继续执行方法如果校验不通过暂停执行不会走上传逻辑对象中两个属性文件大小文件类型文件类型营业执照点击上传只能上传文件且不超过上传实现流程打开本地文件并且校验这个文件是否符合要求按照接口的要求格式得到类型为对象按照要求往中添加字段数据字段名字段值调用上传接口拿到返回的文件地址和其有用的信息存入中的响应式数据的位置将来提交表单表单校验基础校验按照配置统一校验把所有需要校验的表单项都校验一便把校验的结果布尔值返回自定义校验规则校验方法不管是成功还是失败都必须调用单独校验某个表单字段场景表单中有一些特殊的字段没有直接和表单系统进行绑定有值之后不会通知校验系统解决办法手动触发校验逻辑调用组件实例对象的单独校验方法指定的那个规则的响应式缺点对象的属性动态添加不是响应式的解决办法要修改的对象要添加的属性名新属性的值特俗情况视图修改的时候同样可以被收集到本来不存在的属性身上下拉列表的数据单独有一个下拉列表接口没有单独下拉复用表格的列表接口不需要判断状态没有状态的所有数据知道一个事情业务数据是由状态的而且状态可以通过用户操作进行切换表单的清空调用表单组件的实例方法手动做数据的清除网络请求的优化场景限制了请求个数保证只有打开时才请求怎么做到判断第一个参数是否能在第二个参数中找到如果能找到代表打开了通过匹配找到符合条件的第一项然后把找到的项返回通过匹配找到符合条件的第一项然后把找到项的下标值返回只有展开时获取数据并绑定展开或关闭点击行数组对象当前行的对象数组对象先拿到当前行的数据使用当前行的企业数据获取下面的合同列表数据把拿到的合同列表存入企业对象中但是里面没有存放的位置优化网络请求只在打开时才去触发核心拿到当前是打开的条件做判断判断条件第一个是否能在第二个中找到如果找到了代表打开了如果找不到代表收起了如果找到了这一项才回去调用接口带有模板的状态格式化直接可以把后端的数据渲染出来指定要渲染的字段不能直接渲染需要格式化格式化出来的内容一九是一个文本不需要手动传参自动传入插槽插值表达式渲染出来的是函数的返回值格式化待生效生效中已到期已退租不能直接渲染格式化出来的是一个模板插槽插值表达式渲染出来的是函数的返回值对象动态添加响应式属性无法监听到对象属性的添加数组通过下标直接修改也监听不到就会变成响应式后端返回的数据字段不够需要前端自定义字段默认的返回的企业列表数据中没有一个存放合同列表的数据的数组通过映射自定义添加字段文档的预览解决方案通过一个固定的预览地址拼接自己的合同地址然后通过链接在新窗口打开拼接方式业务数据状态变化合同列表当前时间还没有合同的起止时间未开始当前时间已经超过了合同的起止时间已结束当前时间正好式合同期限内且用户没有退租生效中不同的业务数据状态影响显示及操作区域按钮的控制实际开发时如何判断某块业务已经跑通了接口通了并且对应的状态已经确认被修改了导出实际开发过程中的导出前端主导流程调用列表接口把要导出的数据拿到数据的二次转化工作簿工作表单元格数据使用创建一个工作簿使用方法创建一个工作表把工作表添加到工作簿使用中文替换中文表头调用的导出方法工作中遇到了需求参考代码换接口数据二次处理处理表头后端主导最常见流程前端直接调用导出接口后端会把数据转换成文件流当成返回值返回直接触发浏览器的下载功能两种方案的本质区别把数据转化成的过程发生在哪里如果发生在浏览器前端主导如果发生在后端服务器后端主导前端主导处理数据量不能太大后端主导适合处理量大或量小都可账单支付金额的接口计算思想操作表现流程选中了楼宇选中时间调用接口计算之后的数据显示到框内通过事件分别监听一下楼宇什么时候选中时间什么时候选中通过事件绑定回调函数两个组件分别绑定同一个回调函数在事件的回调中判断一下接口必须传参是否都具备了非空判断如果接口参数都不是空正常发接口请求获取计算金额通过进行正常的回填通过属性控制它不可编辑切换类交互场景角色列表切换菜单列表切换组件点击切换通用实现方法点击谁把谁唯一的标识记录下来准备一个激活的类名样式通过中的动态类名当前项激活记录下标树状组件树嵌套的数据结构第一项第二项第三项如何把一个平铺的数组处理成树形的数组大多是情况下都需要前端自己处理第一项第二项第三项前端同步异步的问题初始化的时候使用第一项的进行高亮处理这个方法调用初始化时同步调用而它依赖的都是通过异步获取的为了保证数据已经准备好了模拟同步必须保证上面的俩个异步返回数据之后才调用方法指的是什么基于角色的权限控制思想员工角色权限点先把权限点交给某个角色然后再把角色交给某个员工这个员工自动有了角色下所有的权限点前端菜单路由权限控制权限数据的生成新增一个角色给角色配置权限数据新增一个员工给员工分配这个角色员工就有了当前角色下所有的权限数据完整的实现流程调用接口获取当前员工的权限数据在中编写逻辑里存放个人用户信息里调用时把目标数据出去给另一个模块使用文件中触发获取用户信息有时对权限数据做格式化处理产生两个权限数据一级路由权限数组二级路由权限数组把路由表拆分成两部分动态路由表需要加权限控制静态路由表不需要加权限控制拆分动态路由表导出使用初始化时候只处理静态路由表以一级和二级权限数组作为对主动态路由表做过滤筛选处理有资格加入到路由系统中的动态路由表使用一级权限点过滤一级路由使用二级权限点过滤二级路由最终得到显示左侧的路由表调用函数获取最终的动态路由调用的方法把动态路由表依次添加到路由系统中访问可以渲染对应的组件使用动态路由表数据通过存入然后利用它响应式的特性渲染到左侧菜单中新增一个模块模块先以静态的路由表作为初始值在得到过滤之后的动态路由表之后和之前的静态做一个结合在组件中结合指令做使用中的数据做渲染解决切换用户有缓存的方案在用户退出登录时调用清空路由的方法手动把中的数据也清空用户信息也清空每一个独立的小功能封装成一个独立的小函数维护方便调用函数获取用户权限数据把后端的权限数组格式化成我们自己的俩个权限数据当前的权限数据为一级路由权限二级路由权限根据权限标识过滤路由表最终得到显示到左侧的路由表最终路由表动态添加当浏览器中访问路由的路径显示渲染出来对应的组件存入渲染左侧菜单',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-09-04 22:09:17',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/cursur.css"><link rel="stylesheet" href="/css/fenleiye.css"><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://bu.dusays.com/2023/08/26/64ea10217f8f4.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://wudl.cn" title="主页"><img class="back-menu-item-icon" src="/img/48.png" alt="主页"/><span class="back-menu-item-text">主页</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.wudl.cn" title="博客"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://ccv-engineer.gitee.io/" title="旧站"><img class="back-menu-item-icon" src="/img/32.png" alt="旧站"/><span class="back-menu-item-text">旧站</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://7bu.top/" title="图床"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="图床"/><span class="back-menu-item-text">图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">kilito</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tag faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://chatgpt.wudl.cn"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> ChatGPT</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://ai.99uc.cc/chat"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 私人助理</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/?id=891137324&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/kongtiao/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/zaobao/"><span> 早报</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://bu.dusays.com/2023/08/13/64d894b4a4f06.jpg" target="_blank"><img class="post-qr-code-img" alt="wechat" src="https://bu.dusays.com/2023/08/13/64d894b4a4f06.jpg"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://bu.dusays.com/2023/08/13/64d894b1726cd.jpg" target="_blank"><img class="post-qr-code-img" alt="alipay" src="https://bu.dusays.com/2023/08/13/64d894b1726cd.jpg"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Generato/" style="font-size: 1.05rem;">Generato<sup>1</sup></a><a href="/tags/fetch/" style="font-size: 1.05rem;">fetch<sup>1</sup></a><a href="/tags/js%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 1.05rem;">js面试题<sup>1</sup></a><a href="/tags/koa/" style="font-size: 1.05rem;">koa<sup>1</sup></a><a href="/tags/this/" style="font-size: 1.05rem;">this<sup>1</sup></a><a href="/tags/vue%E5%8E%9F%E7%90%86/" style="font-size: 1.05rem;">vue原理<sup>1</sup></a><a href="/tags/%E6%89%8B%E5%86%99/" style="font-size: 1.05rem;">手写<sup>1</sup></a><a href="/tags/%E6%89%8B%E5%86%99Promise/" style="font-size: 1.05rem;">手写Promise<sup>1</sup></a><a href="/tags/%E6%99%BA%E6%85%A7%E5%9B%AD%E5%8C%BA/" style="font-size: 1.05rem;">智慧园区<sup>1</sup></a><a href="/tags/%E6%9F%AF%E9%87%8C%E5%8C%96/" style="font-size: 1.05rem;">柯里化<sup>1</sup></a><a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 1.05rem;">生活<sup>1</sup></a><a href="/tags/%E7%BB%A7%E6%89%BF/" style="font-size: 1.05rem;">继承<sup>1</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 1.05rem;">设计模式<sup>1</sup></a><a href="/tags/%E9%97%AD%E5%8C%85/" style="font-size: 1.05rem;">闭包<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">九月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/08/"><span class="card-archive-list-date">八月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url">前端</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E6%99%BA%E6%85%A7%E5%9B%AD%E5%8C%BA/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>智慧园区</span></a></span></div></div><h1 class="post-title" itemprop="name headline">智慧园区后台</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-09-04T14:01:29.006Z" title="发表于 2023-09-04 22:01:29">2023-09-04</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-09-04T14:09:17.082Z" title="更新于 2023-09-04 22:09:17">2023-09-04</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">7k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>23分钟</span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为安徽"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>安徽</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://bu.dusays.com/2023/09/04/64f5e41cda997.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://ekilito.github.io/posts/883eae6.html"><header><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url">前端</a><a href="/tags/%E6%99%BA%E6%85%A7%E5%9B%AD%E5%8C%BA/" tabindex="-1" itemprop="url">智慧园区</a><h1 id="CrawlerTitle" itemprop="name headline">智慧园区后台</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">kilito</span><time itemprop="dateCreated datePublished" datetime="2023-09-04T14:01:29.006Z" title="发表于 2023-09-04 22:01:29">2023-09-04</time><time itemprop="dateCreated datePublished" datetime="2023-09-04T14:09:17.082Z" title="更新于 2023-09-04 22:09:17">2023-09-04</time></header><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h1 id="vue-admin"><a href="#vue-admin" class="headerlink" title="vue-admin"></a>vue-admin</h1><p>场景： 二次迭代 </p>
<p><a target="_blank" rel="noopener" href="https://gitee.com/panjiachen/vue-admin-template?_from=gitee_search">vue-admin-template</a>  下载项目 找到核心内容 （自己分到的业务模块）</p>
<h1 id="项目目录"><a href="#项目目录" class="headerlink" title="项目目录"></a>项目目录</h1><p>固定的抽象模式  语义化  + 增加可维护性</p>
<ol>
<li>src - 业务代码 最终浏览器中运行 （目录划分相似 语义化 模块化 - 维护方便）</li>
<li>src之外 - 开发阶段配置文件</li>
</ol>
<h1 id="关键文件"><a href="#关键文件" class="headerlink" title="关键文件"></a>关键文件</h1><ol>
<li><p><strong>package.json  包管理文件</strong></p>
<ol>
<li>scripts  可执行的命令 可以自定义 </li>
<li>dependencies  生产依赖  这里面的包参与业务开发最终打包上线  npm i axios 参与打包  运行浏览器</li>
<li>devDependencies 开发依赖 开发阶段生效 不参与打包  npm i sass -D 不参与打包  开发阶段生效<br>团队开发模式下 整个团队要保证每个人在本地依赖的包都是一样的</li>
</ol>
</li>
<li><p><strong>main.js</strong><br>不写业务代码  全局初始化的事情 初始化三方组件&#x2F;样式初始化&#x2F;store&#x2F;router</p>
<p>全局注册elementui 挂载vuerouter 挂载vuex 渲染app根组件</p>
</li>
<li><p>组件化的开发模式  组件树</p>
</li>
<li><p><strong>vueRouter</strong></p>
<ol>
<li>如果左侧菜单只有一项  如何配置</li>
<li>如果左侧菜单有嵌套  如何配置</li>
</ol>
</li>
<li><p><strong>vuex</strong></p>
<p>解决的问题：把应用中很多地方都会用到的状态统一管理<br>模块化的开发模式：1. 定义模块（state - mutation - action） 2. 把子模块在modules选项中注册好<br>使用vuex中的数据或者方法：加上模块名</p>
<ol>
<li>模块化  namespaced  modules: {子模块}</li>
<li>和数据相关的所有操作都放到vuex中维护 + 组件只做一个事儿 触发action</li>
</ol>
</li>
</ol>
<h1 id="request-js-apis"><a href="#request-js-apis" class="headerlink" title="request.js + apis"></a>request.js + apis</h1><ol>
<li>request 产生一个实例对象给每一个api函数使用  一对多的关系  request配置一次  所有的api函数都会跟着生效</li>
<li>asiox基础封装<ol>
<li>实例化  axios.create({}) baseURL + timeout</li>
<li>请求拦截器 拦截请求处理请求参数再交给后端  headers中注入token</li>
<li>响应拦截器 拦截返回数据做处理再交给客户端  401  return response.data  401状态 数据剥离</li>
</ol>
</li>
<li>拓展<ol>
<li>axios.create() 可以执行多次</li>
<li>拦截器可以有多个（串联参数的模式 前一个拦截器处理完 会把处理之后的数据 下发给下一个拦截器继续处理）</li>
<li>拦截器函数中千万别弄丢 return</li>
</ol>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="comment">// 1. 通用配置</span></span><br><span class="line"><span class="comment">// 2. 定制化配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通用配置</span></span><br><span class="line"><span class="comment">// 1. axios实例化  axios.create() 基地址配置 baseURL + 超时时间 timeout（100ms）</span></span><br><span class="line"><span class="comment">// 拓展：create方法可以调用多次 每次执行都会生成一个独一无二的实例</span></span><br><span class="line"><span class="comment">// export default const a = asiox.create(&#123; baseURL: &#x27;a.com&#x27; &#125;)</span></span><br><span class="line"><span class="comment">// export default const b = asiox.create(&#123; baseURL: &#x27;b.com&#x27; &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 请求拦截器  请求头中添加token数据  接口鉴权  统一配置</span></span><br><span class="line"><span class="comment">// 客户端发送请求 - 请求拦截器(针对请求参数做处理) - 后端</span></span><br><span class="line"><span class="comment">// 拓展：可以添加多个请求拦截器</span></span><br><span class="line"><span class="comment">// 客户端请求 - 拦截器1(处理参数) - 拦截器2 - 后端 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 响应拦截器 数据剥离 res.data / 401错误处理 / 前端自定义错误处理？ </span></span><br><span class="line"><span class="comment">// 后端 - 响应拦截器 - 客户端</span></span><br><span class="line"><span class="comment">// 成功回调 200-300</span></span><br><span class="line"><span class="comment">// 失败回调 不在这个之间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果后端不管接口成功还是失败统一返回200？</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&#x27;https://api-hmzs.itheima.net/v1&#x27;</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span> <span class="comment">// request timeout</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response.<span class="property">data</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 一般项目中多数的接口使用的配置是相似的，所以需要统一配置一次</span><br><span class="line"><span class="number">2.</span> 请求拦截器主要做的事情是在请求发送之前，针对请求参数对象做一些事情（比如添加鉴权<span class="title class_">Token</span>）</span><br><span class="line"><span class="number">3.</span> 响应拦截器主要做的事情是在响应数据返回到业务方之前，针对响应对象做一些事情（比如简化data，错误处理等）</span><br></pre></td></tr></table></figure>



<h1 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h1><ol>
<li><p>业务模式</p>
<ol>
<li><p>表单基础校验</p>
</li>
<li><p>表单统一校验</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. 按照业务要求编写校验规则对象（rules）</span><br><span class="line">2. el-form组件绑定表单对象（model）和规则对象（rules）</span><br><span class="line">3. el-form-item组件通过prop属性指定要使用的校验规则</span><br><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line"> 基础校验</span><br><span class="line">el-form  :model=&quot;表单对象&quot;  :rules=&quot;规则对象&quot;</span><br><span class="line">el-form-item  prop属性指定一下要使用哪条规则</span><br><span class="line">el-input v-model双向绑定</span><br><span class="line"></span><br><span class="line">统一校验</span><br><span class="line">1. 获取表单的实例对象</span><br><span class="line">2. 调用validate方法</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>


</li>
<li><p>后续的业务处理（调用接口 - token - 存入token - 跳转首页 - 提示用户）</p>
</li>
</ol>
</li>
<li><p>表单校验</p>
<ol>
<li>先通过 devtools查看双向啊绑定是否成功</li>
<li>对照接口文档查看接口参数是否一致（拼写+类型）</li>
<li>校验时机实时校验和统一校验都需要</li>
</ol>
</li>
<li><p>token管理</p>
<blockquote>
<p>业务背景：Token的有效期会持续一段时间，在这段时间内没有必要重复请求token，但是Vuex本身是基于内存的管理方式，<strong>刷新浏览器Token会丢失</strong>，为了避免丢失需要配置持久化进行缓存<br>基础思路：</p>
<ol>
<li>存Token数据时，一份存入vuex，一份存入cookie</li>
<li>vuex中初始化Token时，优先从本地cookie取，取不到再初始化为空串儿</li>
</ol>
</blockquote>
<ol>
<li>多模块共享  - vuex维护</li>
<li>管理方式 vuex + cookie(localstorage)</li>
</ol>
<h2 id="为什么要使用Vuex-Cookies"><a href="#为什么要使用Vuex-Cookies" class="headerlink" title="为什么要使用Vuex+Cookies"></a>为什么要使用Vuex+Cookies</h2><blockquote>
<p>俩种存储方式的优势都想要</p>
<ol>
<li>vuex  基于内存  存取快  但是刷新就丢失</li>
<li>ls&#x2F;cookie  基于磁盘  存取速度稍慢  刷新不丢失(持久化)</li>
</ol>
<p>因为我们既可以享受vuex速度优势封装优势 同时保持持久化</p>
</blockquote>
<h2 id="cookie-vs-ls"><a href="#cookie-vs-ls" class="headerlink" title="cookie  vs  ls"></a>cookie  vs  ls</h2><ol>
<li>存数据的空间大小</li>
</ol>
<p>​     ls  5M    cookie kb</p>
<ol start="2">
<li>是否允许后端操作</li>
</ol>
<p>​     ls 纯前端操作   cookie 前端可操作 后端也可操作(占多数)</p>
<ol start="3">
<li>是否跟随接口发送</li>
</ol>
<p>​      cookie</p>
</li>
</ol>
<h1 id="token持久化"><a href="#token持久化" class="headerlink" title="token持久化"></a>token持久化</h1><ol>
<li><p>为什么要进行持久化<br>基于vuex的存储页面刷新token丢失</p>
</li>
<li><p>如何来做</p>
<ol>
<li>在获取到token之后 一式两份  vuex + cookie(ls)</li>
<li>Vuex初始化state的时候 优先从本地取 取不到才初始化为空</li>
</ol>
</li>
<li><p>vuex vs cookie<br>vuex - 基于内存  快 刷新就丢<br>cookie - 基于磁盘 稍慢 持久化</p>
</li>
</ol>
<h1 id="请求头添加token（请求拦截器）"><a href="#请求头添加token（请求拦截器）" class="headerlink" title="请求头添加token（请求拦截器）"></a>请求头添加token（请求拦截器）</h1><ol>
<li><p>为什么要做<br>接口鉴权 </p>
</li>
<li><p>怎么做<br>请求拦截器中统一配置  headers.Authorization &#x3D; token(格式以后端要求的为主)</p>
</li>
</ol>
<h1 id="记住我优化"><a href="#记住我优化" class="headerlink" title="记住我优化"></a>记住我优化</h1><ol>
<li>基础实现逻辑<br>如果当前用户选中了记住，在登录时把用户的信息存入本地 在组件初始化的时候去取数据 回填<br>  如果当前没有选中，在登录时把数据清空</li>
</ol>
<h1 id="接口错误统一处理"><a href="#接口错误统一处理" class="headerlink" title="接口错误统一处理"></a>接口错误统一处理</h1><ol>
<li><p>为什么统一处理<br>很多个接口都需要做这个事儿<br>  而且报错的提示位置和字段和后端协商好的</p>
</li>
<li><p>如何来做<br>axios响应拦截器来做 判断错误信息存在 弹框提示</p>
</li>
</ol>
<h1 id="token是否存在控制路由权限跳转"><a href="#token是否存在控制路由权限跳转" class="headerlink" title="token是否存在控制路由权限跳转"></a>token是否存在控制路由权限跳转</h1><ol>
<li>根据流程图 -&gt; js分支语句</li>
<li>permission.js <ol>
<li>权限相关的事儿都放到这里 模块化的思想</li>
<li>路由权限前置守卫</li>
<li>main.js引入立刻执行</li>
</ol>
</li>
</ol>
<h1 id="数据基础渲染"><a href="#数据基础渲染" class="headerlink" title="数据基础渲染"></a>数据基础渲染</h1><ol>
<li>基础实现逻辑<ol>
<li>准备静态模版（elementUI）</li>
<li>解决初始报错 在data中把模版绑定的数据都声明一遍</li>
<li>封装接口（url&#x2F; method &#x2F; 参数[名称 + 类型 + 参数数量]）</li>
<li>组件中封装一个独立的方法 在方法中调用接口函数 （复用的好处 调用之前做一些额外的参数处理）</li>
<li>选择一个合适生命周期钩子函数调用独立的方法 （created &#x2F; mounted 都可以）</li>
<li>使用数据渲染模版 （数据驱动视图）</li>
</ol>
</li>
</ol>
<h1 id="列表基础渲染"><a href="#列表基础渲染" class="headerlink" title="列表基础渲染"></a>列表基础渲染</h1><ol>
<li><p>实现步骤</p>
<ol>
<li>按照接口文档请求列表接口封装一下（url&#x2F;method&#x2F;参数）[拼写&#x2F;类型]</li>
<li>data准备响应式的数据（以后端接口实际返回为主）</li>
<li>在methods封装一个方法（参数的二次处理 + 调用接口 + 数据赋值）</li>
<li>生命周期钩子函数调用这个方法（created &#x2F; mounted）</li>
<li>把响应式数据绑定组件身上（文档组件要求通过什么属性绑定就通过生命属性）</li>
</ol>
</li>
<li><p>分页功能</p>
<ol>
<li><p>分页的逻辑<br>页数 &#x3D; 总条数 &#x2F; 单页的条数</p>
</li>
<li><p>组件分好页<br>传入总数  :total&#x3D;”100”<br>单页条数  :pageSize&#x3D;”2” 默认10</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- </span><br><span class="line">   1. 页数分出来 （页数 = 总条数 / 每页条数）</span><br><span class="line">   2. 点击每页的时候获取当前页的数据重新渲染到table上</span><br><span class="line">--&gt;</span><br><span class="line">&lt;el-pagination</span><br><span class="line">  layout=&quot;total, prev, pager, next&quot;</span><br><span class="line">  :page-size=&quot;params.pageSize&quot;</span><br><span class="line">  :total=&quot;total&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>


</li>
<li><p>点击分页交互的实现</p>
<ol>
<li><p>点击时拿到当前点击的页数（父组件从子组件获取内部的数据 子传父）<br>@current-change&#x3D;”pageChange”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">pageChange</span>(<span class="params">page</span>) &#123; </span><br><span class="line">   <span class="comment">// console.log(page) // 回调参数 拿到的是当前页</span></span><br><span class="line">   <span class="comment">// 把点击的页数赋值给请求参数页数  </span></span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">params</span>.<span class="property">page</span> = page</span><br><span class="line">   <span class="comment">// 使用最新的请求参数获取列表数据</span></span><br><span class="line">   <span class="variable language_">this</span>.<span class="title function_">getCardList</span>()</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用当前的页数去后端要当前页的数据重新渲染到table</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">params</span>.<span class="property">page</span> = page</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">getList</span>()</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
</li>
</ol>
<h1 id="搜索功能"><a href="#搜索功能" class="headerlink" title="搜索功能"></a>搜索功能</h1><!-- 搜索区域 -->
<pre><code>思路分析：把各种搜索条件当作请求参数发给后端 后端会根据字段对数据库数据做过滤筛选拿到符合条件返回

  1. 表单组件的双向绑定收集到当前的请求数据
        2. 把收集到的表单参数发送接口给后端那符合条件的数据
        3. 把拿到的数据关系显示在列表中
</code></pre>
<p>下拉组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-select v-model=&quot;params.cardStatus&quot;&gt;</span><br><span class="line">     &lt;!-- </span><br><span class="line">        el-select: 双向绑定收集当前选中的数据</span><br><span class="line">        el-option： 下拉框中的每一项</span><br><span class="line">         label（中文显示）</span><br><span class="line">         value （选中之后赋值给v-model的数据将来传给后端）</span><br><span class="line">    --&gt;</span><br><span class="line">   &lt;el-option</span><br><span class="line">     v-for=&quot;item in cardStatusList&quot;</span><br><span class="line">     :key=&quot;item.id&quot;</span><br><span class="line">     :value=&quot;item.id&quot;</span><br><span class="line">     :label=&quot;item.name&quot;</span><br><span class="line">   /&gt;</span><br><span class="line"> &lt;/el-select&gt;</span><br></pre></td></tr></table></figure>





<h1 id="状态适配"><a href="#状态适配" class="headerlink" title="状态适配"></a>状态适配</h1><ol>
<li><p>场景<br>后端返回的数据无法直接显示到页面中 0&#x2F;1 男女</p>
</li>
<li><p>转化的状态码数量只有两个<br>解决方案：三元表达式  status &#x3D;&#x3D;&#x3D; 0? ‘女’ ：’男’</p>
<p>转化的状态码比较多<br>解决方案：映射的方案</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">format</span>(<span class="params">status</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MAP</span> = &#123;</span><br><span class="line">   <span class="number">0</span>:<span class="string">&#x27;女&#x27;</span>,</span><br><span class="line">   <span class="number">1</span>:<span class="string">&#x27;男&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable constant_">MAP</span>[status]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="新增功能"><a href="#新增功能" class="headerlink" title="新增功能"></a>新增功能</h1><pre><code>1. 步骤
   1. 点击跳转到新的路由页面/在当前页面打开一个弹框
   2. 准备表单项（通常只要有表单就会有校验 单独校验 + 统一校验）
   3. 收集表单数据（打开devtools 检测双向绑定是否ok）
   4. 提交 (接口字段不多不少 字段名称完全对应 类型完全匹配)
   5. 后续的逻辑处理 （提供用户 + 重新拉取列表 + 表单的重置 + 路由的重置）
</code></pre>
<h1 id="表单校验"><a href="#表单校验" class="headerlink" title="表单校验"></a>表单校验</h1><ol>
<li><p>简单校验<br>使用elementUI默认的配置项就可以完成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- </span><br><span class="line">  el-form  :model  :rules</span><br><span class="line">  el-form-item  prop指定要用哪条规则</span><br><span class="line">  el-input v-model双向绑定</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>


</li>
<li><p>自定义校验</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="keyword">const</span> <span class="title function_">validateMobile</span> = (<span class="params">rule,value,cb</span>) =&gt; &#123;</span><br><span class="line">      <span class="comment">// 默认的配置 声明式配置</span></span><br><span class="line">      <span class="comment">// 自定义校验逻辑 命令式的校验 写的式逻辑代码</span></span><br><span class="line">      <span class="comment">// value: 输入框的数据 校验的那个数据</span></span><br><span class="line">      <span class="comment">// cb：校验放行函数 不管在通过还是未通过都需要调用它</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  validator： validateMobile</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>对某些字段单独校验</p>
<ol>
<li>场景：默认的表单校验管控不到 出现在自定义组件中 上传</li>
<li>调用单独校验实例方法  this.$refs.form.validateField(‘校验的字段’)</li>
</ol>
</li>
<li><p>表单功能的时候要提前做数据验证 devtools 双向绑定是否生效 生效之后再调用接口</p>
</li>
</ol>
<h1 id="梳理新增和编辑"><a href="#梳理新增和编辑" class="headerlink" title="梳理新增和编辑"></a>梳理新增和编辑</h1><ol>
<li><p>新增 点击新增按钮 - 跳转到新增路由 - 准备表单- 二次参数处理 - 提交新增接口 - 后续处理（提示&#x2F;回跳）</p>
</li>
<li><p>编辑 点击编辑按钮 - 携带id跳转到新增路由 - 准备表单（回填） - 表单校验 - 二次参数处理 - 提交的更新接口 - 提示回跳</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">  scope 作用域插槽</span><br><span class="line">  scope.row  -&gt; 当前行的数据对象</span><br><span class="line"> </span><br><span class="line">  如果我们只是想使用插槽渲染模板 #default</span><br><span class="line">  如果我们除了想要使用插槽渲染模板 而且还想要拿到它内部的数据 #default=&quot;scope&quot;</span><br><span class="line">  scope 类似于函数的形参</span><br><span class="line">  组件内部会把当前行数数据对象当成一个实参传到scope的位置</span><br><span class="line">  </span><br><span class="line">  在内部传递实参的时候 实参的格式</span><br><span class="line">  &#123;</span><br><span class="line">   row: 当前行的对象数据</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  因为本来传下来的就是一个对象 所以通过解构赋值的方式去取row参数 #default=&quot;&#123;row&#125;&quot;</span><br><span class="line"> --&gt;</span><br><span class="line">&lt;el-button size=&quot;mini&quot; type=&quot;text&quot; @click=&quot;editCard(scope.row.id)&quot;&gt;编辑&lt;/el-button&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>重点：</p>
<ol>
<li><p>新增和编辑状态 始终用的就是 id 有id代表当前是编辑状态 没有id代表就是新增状态</p>
<ol>
<li>有id 才获取详情接口</li>
<li>有id 调用更新接口 没有id 调用新增接口</li>
<li>有id 显示编辑 没有id 显示新增</li>
</ol>
</li>
<li><p>点击确定调用接口时区分状态之外 还需区分参数</p>
<ol>
<li>如果是新增接口调用  没有任何id</li>
<li>如果是更新接口调用  请求参数中附加id[相关id数据在数据回填的时候加进去] 通知后端要更新谁</li>
</ol>
</li>
</ol>
<h1 id="上传图片"><a href="#上传图片" class="headerlink" title="上传图片"></a>上传图片</h1><ol>
<li><p>上传的流程<br>点击上传按钮 -&gt; el-upload [打开本地文件选择框 + 上传前的文件校验] -&gt; File -&gt;<br>new FormData()[接口要求传递一个formdata类型的数据] -&gt; 往formData的对象中append字段<br>-&gt; append(‘file’,file) append(‘type’,’business…’) -&gt; 使用完整的formData对象提交接口完成    上传</p>
</li>
<li><p>细节问题</p>
<ol>
<li>el-upload<ol>
<li>非常简单  不需要做任何的自定义配置 默认的配置项完成上传就行了</li>
<li>需要自定义场景  :http-request&#x3D;’function’</li>
<li>如果添加了上传前的校验 流程：先执行上传前的校验函数 函数返回值为true 再执行upload上传函数</li>
<li>函数参数 ：上传前的函数 file对象 [size &#x2F; type做校验] 上传函数  res对象 { file：File }</li>
</ol>
</li>
<li>上传接口接口参数<ol>
<li>常规的接口  contentType  application&#x2F;json</li>
<li>上传接口    contentType  application&#x2F;form-data</li>
</ol>
</li>
<li>前后端校验逻辑要保持一致<br>文件大小  小于5m  &#x2F; 文件类型 jpeg  前端要以这个为主<br>[因为接口不只是可以通过浏览器提交 也可以通过其他方式提交 基于界面操作类校验会失败]</li>
</ol>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line"> :http-request=&quot;uploadRequest&quot; 自定义上传</span><br><span class="line">  action 本来是一个用来配置默认上传的接口地址</span><br><span class="line">  因为我们覆盖了  所以用一个 # 占个位置 消除必填警告</span><br><span class="line">  input type=&quot;file&quot; 本身具备选择文件的能力</span><br><span class="line">  覆盖原因：默认的配置上传不够灵活 仅支持一些简单的上传 </span><br><span class="line"></span><br><span class="line">  如果想要完全自定义上传 http-request</span><br><span class="line">  在选择文件之后 自动执行upload函数 并且把一个对象传给我们</span><br><span class="line">  对象中有一个file属性 就是我们要上传的对象</span><br><span class="line">      </span><br><span class="line">  上传前校验：</span><br><span class="line">    1. 上传图片之前加一层校验 目的为了限制用户上传的文件类型和大小</span><br><span class="line">    2. 如果我们添加了beforeUpload这个属性方法 这个函数中必须return的数据为true</span><br><span class="line">       才会继续执行 upload 方法 如果校验不通过 暂停执行 不会走上传逻辑</span><br><span class="line">    3. file对象中两个属性</span><br><span class="line">       size: 文件大小 / 1024/1024 = M</span><br><span class="line">       type: 文件类型  image/文件类型</span><br><span class="line">--&gt;</span><br><span class="line"></span><br><span class="line">&lt;el-form-item label=&quot;营业执照&quot;&gt;</span><br><span class="line">    &lt;el-upload</span><br><span class="line">      action=&quot;#&quot;</span><br><span class="line">      :http-request=&quot;uploadRequest&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-button size=&quot;small&quot; type=&quot;primary&quot;&gt;点击上传&lt;/el-button&gt;</span><br><span class="line">      &lt;div slot=&quot;tip&quot; class=&quot;el-upload__tip&quot;&gt;只能上传jpg/png文件，且不超过500kb&lt;/div&gt;</span><br><span class="line">    &lt;/el-upload&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- </span><br><span class="line">    上传实现流程：</span><br><span class="line">      1. el-upload 打开本地文件  并且校验这个文件是否符合要求 - File</span><br><span class="line">      2. :http-request = &#x27;upload&#x27;</span><br><span class="line">      3. 按照接口的要求格式 得到类型为FormData对象 new FormData()</span><br><span class="line">      4. 按照要求往 formData中添加字段数据 fd.append(&#x27;字段名&#x27;,&#x27;字段值&#x27;)</span><br><span class="line">      5. 调用上传接口</span><br><span class="line">      6. 拿到返回的文件地址和其有用的信息id 存入data中的响应式数据的位置 将来提交表单</span><br><span class="line">  --&gt;</span><br></pre></td></tr></table></figure>



<h1 id="表单校验-1"><a href="#表单校验-1" class="headerlink" title="表单校验"></a>表单校验</h1><ol>
<li>基础校验  [按照配置]</li>
<li>统一校验  [validate 把所有需要校验的表单项都校验一便 把校验的结果布尔值返回valid]</li>
<li>自定义校验规则 [{ validator:校验方法 rule value cb } 不管是成功还是失败都必须调用cb]</li>
<li>单独校验某个表单字段<ol>
<li>场景：表单中有一些特殊的字段  没有直接和el-form表单系统进行绑定  有值之后不会通知校验系统</li>
<li>解决办法：手动触发校验逻辑 调用el-form组件实例对象的单独校验方法 validateField(‘prop指定的那        个规则’)</li>
</ol>
</li>
</ol>
<h1 id="vue2的响应式缺点"><a href="#vue2的响应式缺点" class="headerlink" title="vue2的响应式缺点"></a>vue2的响应式缺点</h1><p>对象的属性动态添加 不是响应式的<br>Object.defineProperty<br>解决办法：<br>  this.$set(要修改的对象,要添加的属性名，新属性的值)</p>
<p>特俗情况： v-model  视图修改的时候同样可以被收集到本来不存在的属性身上</p>
<h1 id="下拉列表的数据"><a href="#下拉列表的数据" class="headerlink" title="下拉列表的数据"></a>下拉列表的数据</h1><ol>
<li>单独有一个下拉列表接口</li>
<li>没有单独下拉 复用table表格的列表接口（不需要判断状态 没有状态的所有数据）</li>
</ol>
<p>知道一个事情：业务数据是由状态的 而且状态可以通过用户操作进行切换</p>
<h1 id="表单的清空"><a href="#表单的清空" class="headerlink" title="表单的清空"></a>表单的清空</h1><ol>
<li><p>调用表单组件的实例方法 resetFields</p>
</li>
<li><p>手动做数据的清除</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">form</span> = &#123;</span><br><span class="line">   name= <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="网络请求的优化"><a href="#网络请求的优化" class="headerlink" title="网络请求的优化"></a>网络请求的优化</h1><ol>
<li>场景: 限制了请求个数 保证只有打开时才请求</li>
<li>怎么做到？<ol>
<li>判断第一个参数row是否能在第二个参数rows中找到 如果能找到代表打开了</li>
<li>find 通过匹配找到符合条件的第一项 然后把找到的项返回</li>
<li>findIndex 通过匹配找到符合条件的第一项 然后把找到项的下标值返回 splice(index,1)</li>
</ol>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只有展开时获取数据并绑定</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">expandHandle</span>(<span class="params">row, rows</span>) &#123;</span><br><span class="line">  <span class="comment">// console.log(&#x27;展开或关闭&#x27;, row, rows) 点击行row.id  rows数组对象</span></span><br><span class="line">  <span class="comment">// row: 当前行的对象  rows数组对象</span></span><br><span class="line">  <span class="comment">// 1. 先拿到当前行的数据</span></span><br><span class="line">  <span class="comment">// 2. 使用当前行的企业数据，获取下面的合同列表数据</span></span><br><span class="line">  <span class="comment">// 3. 把拿到的合同列表存入企业对象中 但是row里面没有存放的位置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 优化网络请求 只在打开时才去触发 核心：拿到当前是打开的条件 做判断</span></span><br><span class="line">    <span class="comment">// 判断条件：第一个row是否能在第二个rows中找到 如果找到了 代表打开了 如果找不到 代表收起了</span></span><br><span class="line">    <span class="comment">// find findIndex</span></span><br><span class="line">  <span class="keyword">const</span> isExpend = rows.<span class="title function_">find</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">id</span> === row.<span class="property">id</span>)</span><br><span class="line">  <span class="keyword">if</span> (isExpend) &#123;</span><br><span class="line">    <span class="comment">// 如果找到了这一项，才回去调用接口</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getRentListAPI</span>(row.<span class="property">id</span>)</span><br><span class="line">    <span class="comment">// eslint-disable-next-line require-atomic-updates</span></span><br><span class="line">    row.<span class="property">rentList</span> = res.<span class="property">data</span></span><br><span class="line">    </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>





<h1 id="带有模板的状态格式化"><a href="#带有模板的状态格式化" class="headerlink" title="带有模板的状态格式化"></a>带有模板的状态格式化</h1><ol>
<li><p>直接可以把后端的数据渲染出来 prop指定要渲染的字段</p>
</li>
<li><p>不能直接渲染  需要格式化  格式化出来的内容一九是一个文本  string</p>
<ol>
<li>：formatter&#x3D;”formatStatus” 不需要手动传参 自动传入</li>
<li>插槽 + 插值表达式  [渲染出来的是函数的返回值]</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">default</span>=<span class="string">&quot;&#123;row&#125;&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123; formatStatus(row.status) &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<p>&#x2F;&#x2F; 格式化status<br>   formatStatus(type) {<br>  const TYPEMAP &#x3D; {<br>       0: ‘待生效’,<br>    1: ‘生效中’,<br>       2: ‘已到期’,<br>       3: ‘已退租’<br>     }<br>     return TYPEMAP[type]<br>   }</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. 不能直接渲染 格式化出来的是一个模板</span><br><span class="line"></span><br><span class="line">   插槽 + 插值表达式 [渲染出来的是函数的返回值]</span><br><span class="line"></span><br><span class="line">   ```html</span><br><span class="line">   &lt;template default=&quot;&#123;row&#125;&quot;&gt;</span><br><span class="line">       &lt;el-tag&gt; &#123;&#123; formatStatus(row.status) &#125;&#125; &lt;/el-tag&gt;</span><br><span class="line">   &lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>​      </p>
<h1 id="对象动态添加响应式属性"><a href="#对象动态添加响应式属性" class="headerlink" title="对象动态添加响应式属性"></a>对象动态添加响应式属性</h1><ol>
<li><p>vue2 Object.defineProperty  无法监听到对象属性的添加 &#x2F; 数组通过下标直接修改 也监听不到</p>
</li>
<li><p>Vue.set &#x2F; this.$set</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">set</span>(<span class="variable language_">this</span>.<span class="property">form</span>,<span class="string">&#x27;age&#x27;</span>,<span class="number">18</span>) <span class="comment">// 就会变成响应式</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">set</span>(<span class="variable language_">this</span>.<span class="property">list</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;new data&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="后端返回的数据字段不够-需要前端自定义字段"><a href="#后端返回的数据字段不够-需要前端自定义字段" class="headerlink" title="后端返回的数据字段不够 需要前端自定义字段"></a>后端返回的数据字段不够 需要前端自定义字段</h1><p>  默认的返回的企业列表数据中没有一个存放合同列表的数据的数组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">list</span> = res.<span class="property">data</span>.<span class="property">rows</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        ...item,</span><br><span class="line">        <span class="attr">rendList</span>: []  <span class="comment">// 通过映射自定义添加字段</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h1 id="word-文档的预览"><a href="#word-文档的预览" class="headerlink" title="word 文档的预览"></a>word 文档的预览</h1><p>解决方案：通过一个固定的预览地址 拼接 自己的合同url地址 然后通过a链接在新窗口打开</p>
<p>拼接方式：prewViewURL?src&#x3D;url</p>
<h1 id="业务数据状态变化"><a href="#业务数据状态变化" class="headerlink" title="业务数据状态变化"></a>业务数据状态变化</h1><p>合同列表</p>
<ol>
<li>当前时间还没有合同的起止时间 未开始</li>
<li>当前时间已经超过了合同的起止时间 已结束</li>
<li>当前时间正好式合同期限内，且用户没有退租 生效中</li>
</ol>
<p>不同的业务数据状态影响显示及操作区域按钮的控制</p>
<p>实际开发时如何判断某块业务已经跑通了：接口通了并且对应的状态已经确认被修改了</p>
<h1 id="excel导出"><a href="#excel导出" class="headerlink" title="excel导出"></a>excel导出</h1><ol>
<li><p>实际开发过程中的导出</p>
<ol>
<li><p>前端主导（xlsx）</p>
<p>流程：调用列表接口把要导出的数据拿到 -&gt; 数据的二次转化  -&gt;  [excel 工作簿 - 工作表 - 单元格数据] - 使用xlsx创建一个工作簿 - 使用xlsx方法创建一个工作表 - 把工作表添加到工作簿 – [使用中文替换中文表头] 调用xlsx的导出方法</p>
<p>工作中遇到了需求，参考代码 换接口 数据二次处理 处理表头</p>
</li>
<li><p>后端主导（最常见）</p>
<p>流程：前端直接调用导出接口 - 后端会把数据转换成excel文件流当成返回值返回 - 直接触发浏览器的下载功能</p>
</li>
</ol>
</li>
<li><p>两种方案的本质区别：</p>
<p>把数据转化成excel的过程发生在哪里？如果发生在浏览器 前端主导 如果发生在后端服务器 后端主导</p>
<p>前端主导 - 处理数据量不能太大</p>
<p>后端主导 - 适合处理量大或量小都可</p>
</li>
</ol>
<h1 id="账单支付金额的接口计算"><a href="#账单支付金额的接口计算" class="headerlink" title="账单支付金额的接口计算"></a>账单支付金额的接口计算</h1><p>思想：</p>
<p>​    操作表现流程：选中了楼宇 + 选中时间  &#x3D;&gt; 调用接口  -&gt; 计算之后的数据 -&gt; 显示到input框内</p>
<pre><code>1. 通过事件分别监听一下楼宇什么时候选中 时间什么时候选中  [通过事件绑定回调函数 两个组件分别绑定同一个回调函数]
   2. 在事件的回调中判断一下接口必须传参是否都具备了 [非空判断]
   3. 如果接口参数都不是空  正常发接口请求  获取计算金额
   4. 通过 v-model 进行正常的回填  [通过属性控制它不可编辑]
</code></pre>
<h1 id="tab切换类交互"><a href="#tab切换类交互" class="headerlink" title="tab切换类交互"></a>tab切换类交互</h1><ol>
<li>场景：角色列表切换  &#x2F; 菜单列表切换  &#x2F; tabs组件点击切换</li>
<li>通用实现方法<ol>
<li>点击谁把谁index&#x2F;id（唯一的标识）记录下来</li>
<li>准备一个激活的类名样式 active </li>
<li>通过vue中的动态类名:class &#x3D; {acitve: index(当前项index) &#x3D;&#x3D;&#x3D; curIndex（激活记录下标） }</li>
</ol>
</li>
</ol>
<h1 id="树状组件"><a href="#树状组件" class="headerlink" title="树状组件"></a>树状组件</h1><ol>
<li><p>树:嵌套的数据结构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> treeList = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>:<span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">    <span class="attr">title</span>:<span class="string">&#x27;第一项&#x27;</span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">       &#123;</span><br><span class="line">        <span class="attr">id</span>:<span class="string">&#x27;1-1&#x27;</span>,</span><br><span class="line">        <span class="attr">title</span>:<span class="string">&#x27;第二项&#x27;</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">id</span>:<span class="string">&#x27;1-1-1&#x27;</span>,</span><br><span class="line">            <span class="attr">title</span>:<span class="string">&#x27;第三项&#x27;</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>如何把一个平铺的数组处理成树形的数组？<br>大多是情况下 都需要前端自己处理 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> treeList = [</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="attr">id</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">   <span class="attr">title</span>:<span class="string">&#x27;第一项&#x27;</span>,</span><br><span class="line">   <span class="attr">pid</span>: <span class="literal">null</span></span><br><span class="line"> &#125;,</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="attr">id</span>:<span class="string">&#x27;1-1&#x27;</span>,</span><br><span class="line">   <span class="attr">title</span>:<span class="string">&#x27;第二项&#x27;</span>,</span><br><span class="line">   <span class="attr">pid</span>: <span class="string">&#x27;1&#x27;</span></span><br><span class="line"> &#125;,</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="attr">id</span>:<span class="string">&#x27;1-1-1&#x27;</span>,</span><br><span class="line">   <span class="attr">title</span>:<span class="string">&#x27;第三项&#x27;</span>，</span><br><span class="line">   <span class="attr">pid</span>:<span class="string">&#x27;1-1&#x27;</span></span><br><span class="line"> &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="前端同步异步的问题"><a href="#前端同步异步的问题" class="headerlink" title="前端同步异步的问题"></a>前端同步异步的问题</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getRoleList</span>()</span><br><span class="line">  <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getTreeList</span>()</span><br><span class="line">  <span class="comment">// 初始化的时候使用第一项的roleId进行高亮处理</span></span><br><span class="line">  <span class="comment">// 这个方法调用初始化时同步调用 而它依赖的roleList treeList都是通过异步获取的</span></span><br><span class="line">  <span class="comment">// 为了保证数据已经准备好了 模拟同步 必须保证上面的俩个异步返回数据之后才调用方法</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">setTreeByPerms</span>(<span class="variable language_">this</span>.<span class="property">roleList</span>[<span class="number">0</span>].<span class="property">roleId</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="RBAC指的是什么？"><a href="#RBAC指的是什么？" class="headerlink" title="RBAC指的是什么？"></a>RBAC指的是什么？</h1><p>基于角色的权限控制思想<br>员工 - 角色 - 权限点<br>先把权限点交给某个角色 然后再把角色交给某个员工 这个员工自动有了角色下所有的权限点</p>
<h1 id="前端菜单路由权限控制"><a href="#前端菜单路由权限控制" class="headerlink" title="前端菜单路由权限控制"></a>前端菜单路由权限控制</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/09/04/64f5e46ce1093.png" alt="74.png"></p>
<ol>
<li>权限数据的生成（RBAC）<ol>
<li>新增一个角色 给角色配置权限数据</li>
<li>新增一个员工 给员工分配这个角色 员工就有了当前角色下所有的权限数据</li>
</ol>
</li>
<li>完整的实现流程<ol>
<li><p>调用接口获取当前员工的权限数据  permission [‘park:building:add_edit’]</p>
<ol>
<li>在Vuex中编写逻辑，user&#x2F;state里存放个人用户信息 </li>
<li>action里调用时，把permissions目标数据return出去 给另一个js模块使用</li>
<li>permission文件中触发action，获取用户信息（有token时）</li>
</ol>
</li>
<li><p>对权限数据做格式化处理 产生两个权限数据  一级路由权限数组 + 二级路由权限数组</p>
</li>
<li><p>把路由表拆分成两部分 动态路由表[需要加权限控制] + 静态路由表[不需要加权限控制]</p>
<ol>
<li>拆分动态路由表导出使用 asyncRoutes</li>
<li>初始化时候只处理静态路由表  routes: […routes]</li>
</ol>
</li>
<li><p>以一级和二级权限数组作为对主动态路由表做过滤筛选处理 -&gt; 有资格加入到路由系统中的动态路由表</p>
<ol>
<li>使用一级权限点过滤一级路由 使用二级权限点过滤二级路由 最终得到显示左侧的路由表</li>
<li>调用函数获取最终的动态路由</li>
</ol>
</li>
<li><p>调用router的addRoute方法把动态路由表依次添加到路由系统中 访问url可以渲染对应的组件</p>
</li>
<li><p>使用动态路由表数据通过存入Vuex然后利用它响应式的特性 渲染到左侧菜单中</p>
<ol>
<li>vuex新增一个模块，menu模块，先以静态的路由表作为初始值</li>
<li>在得到过滤之后的动态路由表之后，和之前的静态做一个结合</li>
<li>在sidebar组件中结合v-for指令做使用Vuex中的数据做渲染</li>
</ol>
</li>
<li><p>解决切换用户有缓存的bug 方案：在用户退出登录时</p>
<ol>
<li><p>调用清空路由的reset方法</p>
</li>
<li><p>手动把Vuex中的数据也清空</p>
</li>
<li><p>用户信息也清空</p>
</li>
</ol>
</li>
</ol>
</li>
<li>每一个独立的小功能封装成一个独立的小函数 维护方便</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!store.<span class="property">state</span>.<span class="property">user</span>.<span class="property">profile</span>.<span class="property">id</span>) &#123;</span><br><span class="line">       <span class="comment">// 1. 调用action函数获取用户权限数据</span></span><br><span class="line">       <span class="keyword">const</span> permissions = <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/getProfile&#x27;</span>)</span><br><span class="line">       <span class="comment">// 2. 把后端的权限数组格式化成我们自己的俩个权限数据</span></span><br><span class="line">       <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;当前的权限数据为:&#x27;</span>, permissions)</span><br><span class="line">       <span class="keyword">const</span> firstRoutePerms = <span class="title function_">getFirstRoutePerms</span>(permissions)</span><br><span class="line">       <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;一级路由权限&#x27;</span>, firstRoutePerms)</span><br><span class="line">       <span class="keyword">const</span> secondRoutePerms = <span class="title function_">getSecondRoutePerms</span>(permissions)</span><br><span class="line">       <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;二级路由权限&#x27;</span>, secondRoutePerms)</span><br><span class="line">       <span class="comment">// 3. 根据权限标识过滤路由表 最终得到显示到左侧的路由表</span></span><br><span class="line">       <span class="keyword">const</span> routes = <span class="title function_">getRoutes</span>(firstRoutePerms, secondRoutePerms, asyncRoutes)</span><br><span class="line">       <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;最终路由表&#x27;</span>, routes)</span><br><span class="line">       <span class="comment">// 4. addRoute动态添加 (当浏览器中访问路由的路径 显示渲染出来对应的组件)</span></span><br><span class="line">       routes.<span class="title function_">forEach</span>(<span class="function"><span class="params">route</span> =&gt;</span> router.<span class="title function_">addRoute</span>(route))</span><br><span class="line">       <span class="comment">// 5. 存入Vuex渲染左侧菜单</span></span><br><span class="line">       store.<span class="title function_">commit</span>(<span class="string">&#x27;menu/setMenuList&#x27;</span>, routes)</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>



</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/26/64ea10217f8f4.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/26/64ea10217f8f4.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">kilito</div><div class="post-copyright__author_desc">生活明朗,万物可爱</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://ekilito.github.io/posts/883eae6.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://ekilito.github.io/posts/883eae6.html')">智慧园区后台</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://bu.dusays.com/2023/08/13/64d894b4a4f06.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/13/64d894b4a4f06.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://bu.dusays.com/2023/08/13/64d894b1726cd.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/13/64d894b1726cd.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://ekilito.github.io/posts/883eae6.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=智慧园区后台&amp;url=https://ekilito.github.io/posts/883eae6.html&amp;pic=https://bu.dusays.com/2023/09/04/64f5e41cda997.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://ekilito.github.io" target="_blank">kilito</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E6%99%BA%E6%85%A7%E5%9B%AD%E5%8C%BA/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>智慧园区<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/09/04/64f5e41cda997.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/posts/f82ea27.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2022/07/17/62d4106238e7c.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Vue原理</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/26/64ea10217f8f4.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/01/64c884ccc8322.png" ait="status"/></div></div><div class="author-info__description">以欢喜心，慢度日常，四季清宁，万物可爱.</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">kilito</h1><div class="author-info__desc">生活明朗,万物可爱</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/ekilito" target="_blank" title="github"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-github"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/194984444" target="_blank" title="B站"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://cdn.jsdelivr.net/gh/ekilito/picgoblog/img/weixinhao.jpg" target="_blank" title="微信"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-weixin"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://res.abeim.cn/api/qq/?qq=2856509748" target="_blank" title="QQ"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-qq"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://m.weibo.cn/u/7520593701" target="_blank" title="微博"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-weibo"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://music.163.com/#/user/home?id=573476405" target="_blank" title="网易云"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-yinle"></use></svg></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">🍧今天也是元气满满的一天呢~ 开心一点！🍧</div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#vue-admin"><span class="toc-text">vue-admin</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95"><span class="toc-text">项目目录</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E6%96%87%E4%BB%B6"><span class="toc-text">关键文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#request-js-apis"><span class="toc-text">request.js + apis</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%99%BB%E5%BD%95"><span class="toc-text">登录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8Vuex-Cookies"><span class="toc-text">为什么要使用Vuex+Cookies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cookie-vs-ls"><span class="toc-text">cookie  vs  ls</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#token%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">token持久化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%A4%B4%E6%B7%BB%E5%8A%A0token%EF%BC%88%E8%AF%B7%E6%B1%82%E6%8B%A6%E6%88%AA%E5%99%A8%EF%BC%89"><span class="toc-text">请求头添加token（请求拦截器）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%B0%E4%BD%8F%E6%88%91%E4%BC%98%E5%8C%96"><span class="toc-text">记住我优化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E9%94%99%E8%AF%AF%E7%BB%9F%E4%B8%80%E5%A4%84%E7%90%86"><span class="toc-text">接口错误统一处理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#token%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%8E%A7%E5%88%B6%E8%B7%AF%E7%94%B1%E6%9D%83%E9%99%90%E8%B7%B3%E8%BD%AC"><span class="toc-text">token是否存在控制路由权限跳转</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80%E6%B8%B2%E6%9F%93"><span class="toc-text">数据基础渲染</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E5%9F%BA%E7%A1%80%E6%B8%B2%E6%9F%93"><span class="toc-text">列表基础渲染</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD"><span class="toc-text">搜索功能</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E9%80%82%E9%85%8D"><span class="toc-text">状态适配</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%8A%9F%E8%83%BD"><span class="toc-text">新增功能</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C"><span class="toc-text">表单校验</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A2%B3%E7%90%86%E6%96%B0%E5%A2%9E%E5%92%8C%E7%BC%96%E8%BE%91"><span class="toc-text">梳理新增和编辑</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87"><span class="toc-text">上传图片</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C-1"><span class="toc-text">表单校验</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#vue2%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%BA%E7%82%B9"><span class="toc-text">vue2的响应式缺点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8B%E6%8B%89%E5%88%97%E8%A1%A8%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-text">下拉列表的数据</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E7%9A%84%E6%B8%85%E7%A9%BA"><span class="toc-text">表单的清空</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-text">网络请求的优化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%A6%E6%9C%89%E6%A8%A1%E6%9D%BF%E7%9A%84%E7%8A%B6%E6%80%81%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-text">带有模板的状态格式化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%8A%A8%E6%80%81%E6%B7%BB%E5%8A%A0%E5%93%8D%E5%BA%94%E5%BC%8F%E5%B1%9E%E6%80%A7"><span class="toc-text">对象动态添加响应式属性</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E8%BF%94%E5%9B%9E%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%97%E6%AE%B5%E4%B8%8D%E5%A4%9F-%E9%9C%80%E8%A6%81%E5%89%8D%E7%AB%AF%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E6%AE%B5"><span class="toc-text">后端返回的数据字段不够 需要前端自定义字段</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#word-%E6%96%87%E6%A1%A3%E7%9A%84%E9%A2%84%E8%A7%88"><span class="toc-text">word 文档的预览</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE%E7%8A%B6%E6%80%81%E5%8F%98%E5%8C%96"><span class="toc-text">业务数据状态变化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#excel%E5%AF%BC%E5%87%BA"><span class="toc-text">excel导出</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B4%A6%E5%8D%95%E6%94%AF%E4%BB%98%E9%87%91%E9%A2%9D%E7%9A%84%E6%8E%A5%E5%8F%A3%E8%AE%A1%E7%AE%97"><span class="toc-text">账单支付金额的接口计算</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tab%E5%88%87%E6%8D%A2%E7%B1%BB%E4%BA%A4%E4%BA%92"><span class="toc-text">tab切换类交互</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%91%E7%8A%B6%E7%BB%84%E4%BB%B6"><span class="toc-text">树状组件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E5%90%8C%E6%AD%A5%E5%BC%82%E6%AD%A5%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">前端同步异步的问题</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RBAC%E6%8C%87%E7%9A%84%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">RBAC指的是什么？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E8%8F%9C%E5%8D%95%E8%B7%AF%E7%94%B1%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="toc-text">前端菜单路由权限控制</span></a></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/883eae6.html" title="智慧园区后台"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/09/04/64f5e41cda997.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="智慧园区后台"/></a><div class="content"><a class="title" href="/posts/883eae6.html" title="智慧园区后台">智慧园区后台</a><time datetime="2023-09-04T14:01:29.006Z" title="发表于 2023-09-04 22:01:29">2023-09-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f82ea27.html" title="Vue原理"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2022/07/17/62d4106238e7c.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue原理"/></a><div class="content"><a class="title" href="/posts/f82ea27.html" title="Vue原理">Vue原理</a><time datetime="2023-08-20T08:31:26.861Z" title="发表于 2023-08-20 16:31:26">2023-08-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/undefined.html" title="设计模式"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2022/11/30/6386ccb347d84.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="设计模式"/></a><div class="content"><a class="title" href="/posts/undefined.html" title="设计模式">设计模式</a><time datetime="2023-08-19T08:57:01.871Z" title="发表于 2023-08-19 16:57:01">2023-08-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/882eae5.html" title="JS原理二"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/02/20/63f371a777341.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JS原理二"/></a><div class="content"><a class="title" href="/posts/882eae5.html" title="JS原理二">JS原理二</a><time datetime="2023-08-17T13:09:03.001Z" title="发表于 2023-08-17 21:09:03">2023-08-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/882eae.html" title="JS原理一"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/21/64e360fd692ba.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JS原理一"/></a><div class="content"><a class="title" href="/posts/882eae.html" title="JS原理一">JS原理一</a><time datetime="2023-08-16T01:57:51.358Z" title="发表于 2023-08-16 09:57:51">2023-08-16</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:2856509748@qq.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://weibo.com/u/7520593701" title="微博"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://res.abeim.cn/api/qq/?qq=2856509748" title="QQ"><i class="anzhiyufont anzhiyu-icon-qq"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/26/64ea10217f8f4.jpg" size="50px"/><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/ekilito" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://space.bilibili.com/194984444" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://www.douyin.com/user/MS4wLjABAAAAyFaeLYIe730NcTBynr1H-tGRx3EfYELNjx05MMP4pEc" title="抖音"><i class="anzhiyufont anzhiyu-icon-tiktok"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="51la统计" target="_blank" rel="noopener" href="https://v6.51.la/">51la统计</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener" href="https://www.foreverblog.cn/">十年之约</a><a class="footer-item" title="开往" target="_blank" rel="noopener" href="https://github.com/travellings-link/travellings">开往</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/糖果屋-营业中-6adea8?style=social&amp;logo=cakephp" alt="小小清" title="小小清"/><div id="runtimeTextTip"></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" style="margin-inline:5px" data-title="本站使用多吉云为静态资源提供CDN加速" title="本站使用多吉云为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/CDN-多吉云-3693F3.svg" alt="本站使用多吉云为静态资源提供CDN加速"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2022 - 2023 By <a class="footer-bar-link" href="/" title="kilito" target="_blank">kilito</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = ["生活明朗&#44; 万物可爱&#44; 人间值得&#44; 未来可期.","你今天真好看！","今天也是元气满满的一天呢！","以欢喜心&#44;慢度日常&#44;四季清宁&#44;万物可爱."]
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.0.15/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/ekilito/blog" title="主题">主题</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://7bu.top/" title="图床">图床</a><a class="footer-bar-link cc" href="/copyright" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">3</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://wudl.cn" title="主页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/48.png" alt="主页"/><span class="back-menu-item-text">主页</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.wudl.cn" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://ccv-engineer.gitee.io/" title="旧站"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/32.png" alt="旧站"/><span class="back-menu-item-text">旧站</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://7bu.top/" title="图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="图床"/><span class="back-menu-item-text">图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tag faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://chatgpt.wudl.cn"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> ChatGPT</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://ai.99uc.cc/chat"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 私人助理</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/?id=891137324&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/kongtiao/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/zaobao/"><span> 早报</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Generato/" style="font-size: 0.88rem;">Generato<sup>1</sup></a><a href="/tags/fetch/" style="font-size: 0.88rem;">fetch<sup>1</sup></a><a href="/tags/js%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 0.88rem;">js面试题<sup>1</sup></a><a href="/tags/koa/" style="font-size: 0.88rem;">koa<sup>1</sup></a><a href="/tags/this/" style="font-size: 0.88rem;">this<sup>1</sup></a><a href="/tags/vue%E5%8E%9F%E7%90%86/" style="font-size: 0.88rem;">vue原理<sup>1</sup></a><a href="/tags/%E6%89%8B%E5%86%99/" style="font-size: 0.88rem;">手写<sup>1</sup></a><a href="/tags/%E6%89%8B%E5%86%99Promise/" style="font-size: 0.88rem;">手写Promise<sup>1</sup></a><a href="/tags/%E6%99%BA%E6%85%A7%E5%9B%AD%E5%8C%BA/" style="font-size: 0.88rem;">智慧园区<sup>1</sup></a><a href="/tags/%E6%9F%AF%E9%87%8C%E5%8C%96/" style="font-size: 0.88rem;">柯里化<sup>1</sup></a><a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 0.88rem;">生活<sup>1</sup></a><a href="/tags/%E7%BB%A7%E6%89%BF/" style="font-size: 0.88rem;">继承<sup>1</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 0.88rem;">设计模式<sup>1</sup></a><a href="/tags/%E9%97%AD%E5%8C%85/" style="font-size: 0.88rem;">闭包<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="7061615494" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/user/home?id=573476405&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script> // 消除控制台打印
 var HoldLog = console.log;
 console.log = function () {};
 let now1 = new Date();
 queueMicrotask(() => {
   const Log = function () {
     HoldLog.apply(console, arguments);
   }; //在恢复前输出日志
   const grt = new Date("08/04/2023 20:00:00"); //此处修改你的建站时间或者网站上线时间
   now1.setTime(now1.getTime() + 250);
   const days = (now1 - grt) / 1000 / 60 / 60 / 24;
   const dnum = Math.floor(days);
   const ascll = [
     `欢迎来到ekilito🥝の小窝!`,
     `Future is now 🍭🍭🍭`,
     `
         
  
██    ██   ██   ██        ██   ████████    ██████  
██  ██     ██   ██        ██      ██      ██    ██ 
████       ██   ██        ██      ██      ██    ██ 
██  ██     ██   ██        ██      ██      ██    ██ 
██    ██   ██   ███████   ██      ██       ██████  
         
         `,
     "已上线",
     dnum,
     "天",
     "©2022 By kilito V1.6.6",
   ];
   const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

   setTimeout(
     Log.bind(
       console,
       `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
       "color:#3b70fc",
       "",
       "color:#3b70fc",
       "color:#3b70fc",
       "",
       "color:#3b70fc",
       ""
     )
   );
   setTimeout(
     Log.bind(
       console,
       `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
       "color:white; background-color:#4fd953",
       "",
       "",
       'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
     )
   );

   setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

   setTimeout(
     console.warn.bind(
       console,
       "%c ⚡ Powered by 小小清 %c 你正在访问 kilito 的博客.",
       "color:white; background-color:#f0ad4e",
       ""
     )
   );

   setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

   setTimeout(
     console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
   );
 });</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("08/04/2023 20:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      img.src = "https://img.shields.io/badge/糖果屋-打烊了-6adea8?style=social&amp;logo=coffeescript";
      img.title = "小小清";
      img.alt = "小小清";

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.wudl.cn/',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.18/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.wudl.cn/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.wudl.cn/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.18/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "longlong1015@outlook.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="/js/gghello.js"></script><script src="/js/iconfont.js"></script><script src="/js/cursur.js"></script><script type="text/javascript" src="https://unpkg.zhimg.com/jquery@latest/dist/jquery.min.js"></script><script src="/js/fps.js"></script><div id="fps"></div><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>